{"version":3,"sources":["src/menu-container.tsx"],"names":["clientRect","this","menuOverlay","getBoundingClientRect","menuWrapper","menuLeft","menuTop","menuWidth","props","rect","state","window","allowRectChange","e","el","onRef","exports","MenuContainer"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;mHAAA,MAAAA,EAAAC,KAAAC,YAAAC,gLACA,MAAAH,EAAAC,KAAAG,YAAAD,iJACA,MAAAE,SAAAA,EAAAC,QAAAA,EAAAC,UAAAA,GAAAN,KAAAO,mlBAAA,0OAiBIC,KAAAR,KAAAS,MAAAR,yEAGAD,KAAAU,wZAMAV,KAAAW,gBAAAC,gNAAIC,GAAAb,KAAAO,MAAAO,8CAIJd,KAAAG,qmBAAIY,EAyDRC,cAAAA","sourcesContent":["import { bind, debounce } from 'lodash-decorators';\nimport * as React from 'react';\nimport { createPortal } from 'react-dom';\nimport styled from 'styled-components';\nimport { MenuContainerProps, Rect } from './typings';\nimport { getDocument, getWindow, getWindowInnerHeight } from './utils';\n\nexport interface MenuContainerState {\n    menuOverlay?: Rect;\n    menuWrapper?: Rect;\n}\n\ninterface MenuWrapperProps {\n    rect?: Rect;\n    menuHeight?: MenuContainerProps['menuHeight'];\n    error?: boolean;\n}\n\nfunction menuPosition({\n    rect,\n    menuHeight = 186\n}: MenuWrapperProps): 'top' | 'bottom' {\n    if (!rect) {\n        return 'bottom';\n    }\n\n    const { height } = rect;\n\n    if (height === 'auto' || menuHeight === 'auto') {\n        return 'bottom';\n    }\n\n    if (rect.top + height + menuHeight <= getWindowInnerHeight()) {\n        return 'bottom';\n    }\n\n    return 'top';\n}\n\nfunction getContainerTop(props: MenuWrapperProps): number {\n    const { rect } = props;\n\n    if (!rect) {\n        return 0;\n    }\n\n    const menuHeight = (props.menuHeight !== 'auto' && props.menuHeight) || 186;\n    const height = rect.height === 'auto' ? 32 : rect.height;\n\n    switch (menuPosition(props)) {\n        case 'top':\n            return rect.top - menuHeight + 1;\n        case 'bottom':\n            return rect.top + height - 1;\n    }\n}\n\nconst MenuOverlay = styled.div`\n    width: 100%;\n    height: 100%;\n    position: absolute;\n    left: 0;\n    top: 0;\n    pointer-events: none;\n`;\n\nconst MenuWrapper = styled.div`\n    position: fixed;\n    z-index: 9999;\n    background: #fff;\n    box-sizing: border-box;\n    box-shadow: ${(props: MenuWrapperProps) =>\n        menuPosition(props) === 'bottom'\n            ? '0 2px 5px rgba(0, 0, 0, 0.1)'\n            : '0 -2px 5px rgba(0, 0, 0, 0.1)'};\n\n    .ReactVirtualized__List {\n        border-width: 1px;\n        border-style: solid;\n        border-color: ${(props: MenuWrapperProps) =>\n            props.error ? 'var(--react-slct-error-color)' : '#ccc'};\n        background-color: #fff;\n\n        &:focus {\n            outline: none;\n        }\n    }\n`;\n\nexport class MenuContainer extends React.PureComponent<\n    MenuContainerProps,\n    MenuContainerState\n> {\n    private menuOverlay?: HTMLDivElement | null;\n    private menuWrapper?: HTMLDivElement | null;\n\n    private get menuOverlayRect(): Rect | undefined {\n        if (this.menuOverlay) {\n            const clientRect = this.menuOverlay.getBoundingClientRect();\n\n            return {\n                left: Math.round(clientRect.left),\n                top: Math.round(clientRect.top),\n                width: Math.round(clientRect.width),\n                height: Math.round(clientRect.height)\n            };\n        }\n\n        return undefined;\n    }\n\n    private get menuWrapperRect(): Rect | undefined {\n        if (this.menuWrapper) {\n            const clientRect = this.menuWrapper.getBoundingClientRect();\n\n            return {\n                left: Math.round(clientRect.left),\n                top: Math.round(clientRect.top),\n                width: Math.round(clientRect.width),\n                height: Math.round(clientRect.height)\n            };\n        }\n\n        return undefined;\n    }\n\n    private get style(): Rect {\n        const { menuLeft, menuTop, menuWidth } = this.props;\n        const { menuOverlay, menuWrapper } = this.state;\n        const menuHeight =\n            this.props.menuHeight ||\n            (menuWrapper ? menuWrapper.height : 'auto');\n\n        return {\n            top:\n                menuTop !== undefined\n                    ? menuTop\n                    : getContainerTop({\n                          rect: menuOverlay,\n                          menuHeight\n                      }),\n            left:\n                menuLeft !== undefined\n                    ? menuLeft\n                    : menuOverlay\n                    ? menuOverlay.left\n                    : 0,\n            width: menuWidth || (menuOverlay ? menuOverlay.width : 'auto'),\n            height: menuHeight || (menuWrapper ? menuWrapper.height : 'auto')\n        };\n    }\n\n    private get window() {\n        return getWindow();\n    }\n\n    private get document() {\n        return getDocument();\n    }\n\n    constructor(props: MenuContainerProps) {\n        super(props);\n\n        this.state = {};\n    }\n\n    public componentDidMount(): void {\n        this.addListener();\n    }\n\n    public componentDidUpdate(_: any, prevState: MenuContainerState): void {\n        const { menuOverlay, menuWrapper } = this.state;\n\n        if (this.props.onRect) {\n            if (\n                prevState.menuOverlay !== menuOverlay ||\n                prevState.menuWrapper !== menuWrapper\n            ) {\n                this.props.onRect(menuOverlay, menuWrapper);\n            }\n        }\n    }\n\n    public componentWillUnmount(): void {\n        this.removeListener();\n    }\n\n    public render(): React.ReactNode {\n        const { error, onClick, children } = this.props;\n        const className = ['react-slct-menu', this.props.className]\n            .filter(c => c)\n            .join(' ');\n\n        return (\n            <MenuOverlay ref={this.onMenuOverlay}>\n                {this.document\n                    ? createPortal(\n                          <MenuWrapper\n                              data-role=\"menu\"\n                              className={className}\n                              error={error}\n                              ref={this.onMenuWrapper}\n                              onClick={onClick}\n                              rect={this.state.menuOverlay}\n                              style={this.style}\n                          >\n                              {children}\n                          </MenuWrapper>,\n                          this.document.body\n                      )\n                    : null}\n            </MenuOverlay>\n        );\n    }\n\n    private addListener(): void {\n        if (this.window) {\n            this.window.addEventListener('scroll', this.onViewportChange, true);\n            this.window.addEventListener('resize', this.onViewportChange, true);\n        }\n    }\n\n    private removeListener(): void {\n        if (this.window) {\n            this.window.removeEventListener(\n                'resize',\n                this.onViewportChange,\n                true\n            );\n            this.window.removeEventListener(\n                'scroll',\n                this.onViewportChange,\n                true\n            );\n        }\n    }\n\n    private allowRectChange(e): boolean {\n        if (e.target.closest && !e.target.closest('.react-slct-menu')) {\n            return false;\n        }\n\n        return true;\n    }\n\n    @bind\n    private onViewportChange(e): void {\n        if (this.allowRectChange(e)) {\n            this.setState({\n                menuOverlay: this.menuOverlayRect,\n                menuWrapper: this.menuWrapperRect\n            });\n        }\n    }\n\n    @bind\n    private onMenuOverlay(el: HTMLDivElement | null): void {\n        this.menuOverlay = el;\n\n        if (this.menuOverlay) {\n            this.setState({\n                menuOverlay: this.menuOverlayRect\n            });\n        }\n    }\n\n    @bind\n    @debounce(16)\n    private onMenuWrapper(el: HTMLDivElement | null): void {\n        if (el && this.props.onRef) {\n            this.props.onRef(el);\n        }\n\n        this.menuWrapper = el;\n\n        if (this.menuWrapper) {\n            this.setState({\n                menuWrapper: this.menuWrapperRect\n            });\n        }\n    }\n}\n"]}