{"version":3,"sources":["src/value.tsx"],"names":["lodash_decorators_1","$fsx","r","React","styled_components_1","label_1","utils_1","value_component_multi_1","value_component_single_1","Button","default","button","ArrowButton","ValueContainer","div","props","mobile","disabled","error","focused","ValueLeft","multi","hasValue","ValueRight","Placeholder","SelectLabel","ClearButton","ClearContainer","span","ClearX","createElement","Search","canSearch","css","Value","PureComponent","[object Object]","super","this","search","createRef","window","getWindow","addEventListener","blur","prevProps","current","innerText","focus","options","value","clearable","open","equalCompareProp","ArrowComponent","arrowComponent","ClearComponent","clearComponent","valueOptions","getValueOptions","showClearer","Boolean","length","searchAtStart","searchAtEnd","data-role","className","onClick","renderSearch","renderValues","type","tabIndex","onClear","searchable","keepSearchOnBlur","onSearchFocus","onSearchBlur","contentEditable","onInput","onSearch","onKeyDown","onFocus","onBlur","ref","placeholder","labelComponent","valueComponentSingle","valueComponentMulti","Single","ValueComponentSingle","Multi","ValueComponentMulti","map","option","key","toKey","onRemove","onOptionRemove","el","getSelection","document","createRange","range","sel","selectNodeContents","collapse","removeAllRanges","addRange","e","stopPropagation","currentTarget","trim","preventDefault","metaKey","keyCode","keys","TAB","ENTER","ARROW_UP","ARROW_DOWN","tslib_1","__decorate","bind","SyntheticEvent","_a","Object","KeyboardEvent","_b","_c","exports"],"mappings":"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","sourcesContent":["import { bind } from 'lodash-decorators';\nimport * as React from 'react';\nimport styled, { css } from 'styled-components';\nimport { SelectLabel } from './label';\nimport { keys, getValueOptions, getWindow, toKey } from './utils';\nimport { SelectProps, Option } from './typings';\nimport { ValueComponentMulti } from './value-component-multi';\nimport { ValueComponentSingle } from './value-component-single';\n\nexport interface ValueProps {\n    options: SelectProps['options'];\n    value: SelectProps['value'];\n    placeholder: SelectProps['placeholder'];\n    clearable: SelectProps['clearable'];\n    searchable: SelectProps['searchable'];\n    labelComponent: SelectProps['labelComponent'];\n    valueComponentSingle: SelectProps['valueComponentSingle'];\n    valueComponentMulti: SelectProps['valueComponentMulti'];\n    arrowComponent: SelectProps['arrowComponent'];\n    clearComponent: SelectProps['clearComponent'];\n    multi: SelectProps['multi'];\n    mobile: SelectProps['native'];\n    disabled: SelectProps['disabled'];\n    error: SelectProps['error'];\n    equalCompareProp: SelectProps['equalCompareProp'];\n    search?: string;\n    keepSearchOnBlur?: boolean;\n    open: boolean;\n    focused?: boolean;\n    onClear(): void;\n    onClick(): void;\n    onSearch(search: string): void;\n    onSearchFocus(): void;\n    onSearchBlur(): void;\n    onOptionRemove(value: any): void;\n}\n\ninterface SearchProps {\n    canSearch?: boolean;\n}\n\ninterface ValueContainerProps {\n    mobile?: boolean;\n    disabled?: boolean;\n    focused?: boolean;\n    error?: boolean;\n}\n\ninterface ValueLeftProps {\n    multi?: boolean;\n    hasValue?: boolean;\n}\n\nconst Button = styled.button`\n    background: transparent;\n    border: none;\n    margin: 0;\n    font-size: 20px;\n    padding: 0;\n    line-height: 1;\n    cursor: pointer;\n\n    &:focus {\n        outline: none;\n    }\n`;\n\nconst ArrowButton = styled(Button)`\n    font-size: 12px;\n    color: #ccc;\n    transform: translateY(2px);\n\n    &:hover {\n        color: #333;\n    }\n`;\n\nconst ValueContainer = styled.div`\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    flex: 1;\n    min-height: 32px;\n    pointer-events: ${(props: ValueContainerProps) =>\n        props.mobile || props.disabled ? 'none' : 'auto'};\n    padding: 5px 10px;\n    background: #fff;\n    cursor: default;\n    border-width: 1px;\n    border-style: solid;\n    border-color: ${(props: ValueContainerProps) =>\n        props.error ? 'var(--react-slct-error-color)' : '#ccc'};\n    z-index: 0;\n    box-sizing: border-box;\n    max-width: 100%;\n    box-shadow: ${(props: ValueContainerProps) =>\n        props.focused ? 'rgba(0, 0, 0, 0.15) 0 0 2px' : 'none'};\n`;\n\nconst ValueLeft = styled.div`\n    display: flex;\n    flex: 1;\n    align-items: center;\n    flex-wrap: ${(props: ValueLeftProps) =>\n        props.multi && props.hasValue ? 'wrap' : 'nowrap'};\n    user-select: none;\n    min-width: 0;\n    box-sizing: border-box;\n    margin: ${(props: ValueLeftProps) =>\n        props.multi && props.hasValue ? '-2px -5px' : 0};\n`;\n\nconst ValueRight = styled.div`\n    display: flex;\n    align-items: center;\n    margin-left: 4px;\n    box-sizing: border-box;\n`;\n\nconst Placeholder = styled(SelectLabel)`\n    color: #aaa;\n`;\n\nconst ClearButton = styled(Button)`\n    margin-right: 6px;\n`;\n\nconst ClearContainer = styled.span`\n    color: #ccc;\n\n    &:hover {\n        color: #333;\n    }\n`;\n\nconst ClearX = () => <ClearContainer>×</ClearContainer>;\n\nconst Search = styled.span`\n    min-width: 1px;\n    margin-left: -1px;\n    user-select: text;\n\n    ${(props: SearchProps) =>\n        props.canSearch\n            ? css`\n                  opacity: 1;\n                  position: relative;\n                  left: 1px;\n              `\n            : css`\n                  position: absolute;\n                  opacity: 0;\n              `}\n\n    &:focus {\n        outline: none;\n    }\n`;\n\nexport class Value extends React.PureComponent<ValueProps> {\n    search: React.RefObject<HTMLSpanElement>;\n\n    constructor(props: ValueProps) {\n        super(props);\n\n        this.search = React.createRef();\n\n        const window = getWindow();\n\n        if (window) {\n            window.addEventListener('blur', this.blur);\n        }\n    }\n\n    public componentDidUpdate(prevProps: ValueProps): void {\n        if (prevProps.search && !this.props.search && this.search.current) {\n            this.search.current.innerText = '';\n        }\n\n        if (prevProps.focused !== this.props.focused && this.props.focused) {\n            this.focus();\n        }\n    }\n\n    public render(): React.ReactNode {\n        const {\n            options = [],\n            value,\n            disabled,\n            clearable,\n            open,\n            mobile,\n            multi,\n            focused,\n            equalCompareProp,\n            error\n        } = this.props;\n        const ArrowComponent = this.props.arrowComponent;\n        const ClearComponent = this.props.clearComponent || ClearX;\n        const valueOptions = getValueOptions(\n            options,\n            value,\n            multi,\n            equalCompareProp\n        );\n        const showClearer = Boolean(\n            clearable && valueOptions.length && !mobile\n        );\n        const searchAtStart = !multi || valueOptions.length === 0;\n        const searchAtEnd = multi && valueOptions.length > 0;\n\n        return (\n            <ValueContainer\n                data-role=\"value\"\n                className=\"react-slct-value\"\n                disabled={disabled}\n                mobile={mobile}\n                focused={focused}\n                error={error}\n                onClick={this.onClick}\n            >\n                <ValueLeft\n                    className=\"value-left\"\n                    multi={multi}\n                    hasValue={!!valueOptions.length}\n                >\n                    {searchAtStart && this.renderSearch()}\n                    {this.renderValues(valueOptions)}\n                    {searchAtEnd && this.renderSearch()}\n                </ValueLeft>\n                <ValueRight className=\"value-right\">\n                    {showClearer && (\n                        <ClearButton\n                            type=\"button\"\n                            tabIndex={-1}\n                            className=\"clearer\"\n                            onClick={this.onClear}\n                        >\n                            <ClearComponent />\n                        </ClearButton>\n                    )}\n                    <ArrowButton type=\"button\" className=\"arrow\" tabIndex={-1}>\n                        {ArrowComponent ? (\n                            <ArrowComponent open={open} />\n                        ) : open ? (\n                            '▲'\n                        ) : (\n                            '▼'\n                        )}\n                    </ArrowButton>\n                </ValueRight>\n            </ValueContainer>\n        );\n    }\n\n    private renderSearch(): React.ReactNode {\n        const {\n            open,\n            value,\n            disabled,\n            searchable,\n            search,\n            keepSearchOnBlur,\n            onSearchFocus,\n            onSearchBlur\n        } = this.props;\n        const canSearch =\n            (open && searchable) ||\n            (keepSearchOnBlur && !value && searchable) ||\n            Boolean(search);\n\n        if (disabled && !keepSearchOnBlur) {\n            return null;\n        }\n\n        return (\n            <Search\n                className=\"search\"\n                contentEditable\n                canSearch={canSearch}\n                onInput={this.onSearch}\n                onKeyDown={this.onKeyDown}\n                onFocus={onSearchFocus}\n                onBlur={onSearchBlur}\n                ref={this.search as any}\n            />\n        );\n    }\n\n    private renderValues(valueOptions: Option[]): React.ReactNode {\n        const {\n            placeholder,\n            search,\n            labelComponent,\n            valueComponentSingle,\n            valueComponentMulti,\n            multi,\n            open\n        } = this.props;\n\n        if (search && open && !multi) {\n            return null;\n        }\n\n        if (valueOptions.length === 0 && !search) {\n            return <Placeholder>{placeholder}</Placeholder>;\n        }\n\n        const Single = valueComponentSingle || ValueComponentSingle;\n        const Multi = (valueComponentMulti || ValueComponentMulti) as any;\n\n        return valueOptions.map((option) =>\n            multi ? (\n                <Multi\n                    key={toKey(option.value, this.props.equalCompareProp)}\n                    option={option}\n                    labelComponent={labelComponent}\n                    options={valueOptions}\n                    onRemove={this.props.onOptionRemove}\n                />\n            ) : (\n                <Single\n                    key={toKey(option.value, this.props.equalCompareProp)}\n                    option={option}\n                    labelComponent={labelComponent}\n                />\n            )\n        );\n    }\n\n    private focus(): void {\n        const el = this.search.current;\n\n        if (el) {\n            el.focus();\n\n            if (\n                typeof window.getSelection != 'undefined' &&\n                typeof document.createRange != 'undefined'\n            ) {\n                const range = document.createRange();\n                const sel = window.getSelection();\n\n                range.selectNodeContents(el);\n                range.collapse(false);\n\n                if (sel) {\n                    sel.removeAllRanges();\n                    sel.addRange(range);\n                }\n            }\n        }\n    }\n\n    @bind\n    private blur(): void {\n        if (this.search.current) {\n            this.search.current.blur();\n        }\n    }\n\n    @bind\n    private onClick(): void {\n        if (!this.props.disabled) {\n            this.focus();\n            this.props.onClick();\n        }\n    }\n\n    @bind\n    private onClear(e: React.SyntheticEvent<HTMLButtonElement>): void {\n        e.stopPropagation();\n\n        this.props.onClear();\n    }\n\n    @bind\n    private onSearch(e: React.KeyboardEvent<HTMLSpanElement>) {\n        if (this.props.searchable) {\n            this.props.onSearch(e.currentTarget.innerText.trim());\n        } else {\n            e.preventDefault();\n        }\n    }\n\n    @bind\n    private onKeyDown(e: React.KeyboardEvent<HTMLSpanElement>) {\n        const { searchable } = this.props;\n\n        if (e.metaKey) {\n            return;\n        }\n\n        if (\n            (!searchable && e.keyCode !== keys.TAB) ||\n            e.keyCode === keys.ENTER ||\n            e.keyCode === keys.ARROW_UP ||\n            e.keyCode === keys.ARROW_DOWN\n        ) {\n            e.preventDefault();\n        }\n    }\n}\n"]}